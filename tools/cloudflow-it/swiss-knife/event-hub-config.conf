
cloudflow {
  topics {
    source-data-pipe = ${shared-config}  {
      producers = [ingress.out]
      consumers = [raw-egress.in, akka-process.in, spark-process.in, flink-process.in, spark-config-output.in, akka-config-output.in]
    }

    akka-pipe = ${shared-config}  {
      producers = [akka-process.out]
      consumers = [akka-egress.in]
    }

    spark-pipe = ${shared-config}  {
      producers = [spark-process.out]
      consumers = [spark-egress.in]
    }

    flink-pipe = ${shared-config}  {
      producers = [flink-process.out]
      consumers = [flink-egress.in]
    }
  }
}

shared-config {
  connection-config = ${kafka-connection-config}
}

# minimum plan is standard:
# https://stackoverflow.com/a/63300108
kafka-connection-config {
  bootstrap.servers="cloudflow-event-hub.servicebus.windows.net:9093"

  security.protocol=SASL_SSL
  sasl.mechanism=PLAIN
  sasl.jaas.config="""org.apache.kafka.common.security.plain.PlainLoginModule required username="$ConnectionString" password="Endpoint=sb://cloudflow-event-hub.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=DrszvIPYVgK81n0cYMlXBHjHL6l3XvTLKkFZJnICnXE=";"""

}
